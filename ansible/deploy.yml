---
- name: Demo playbook
  hosts: localhost
  tasks:
    - name: Clone app from git
      git:
        repo: 'https://github.com/vanduyms/trello'
        dest: '/ansible/app'
        clone: yes
        update: yes
    - name: Debug directory structure
      command: ls -l /ansible/app
      register: ls_result

    - name: Show directory contents
      debug:
        var: ls_result.stdout

    - name: add .env file to backend
      copy:
        src: '/ansible/.env'
        dest: '/ansible/app/trello/backend'
        mode: '0644'
    - name: Build and start the backend
      shell: |
        cd /ansible/app/trello/backend
        npm install
        npm run build
        npm run dev
      args:
        chdir: /ansible/app/trello/backend
    - name: Build and start the frontend
      shell: |
        cd /ansible/app/trello/frontend
        npm install
        npm run build
        npm run dev
      args:
        chdir: /ansible/app/trello/frontend